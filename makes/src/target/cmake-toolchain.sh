#! /usr/bin/env bash

set -e

TOOLCHAIN_CMAKE_OUT=cmake-toolchain.cmake

if [ "$WPITARGET" = "Windows" ]; then
    BIN_EXT=".exe"
fi

cat <<EOF >${TOOLCHAIN_CMAKE_OUT}
set(CMAKE_SYSTEM_NAME Linux)
set(CMAKE_SYSTEM_PROCESSOR arm)
set(CMAKE_SYSTEM_VERSION 1)

set(CMAKE_C_COMPILER \${CMAKE_CURRENT_LIST_DIR}/bin/${TARGET_TUPLE}-clang$BIN_EXT)
set(CMAKE_CXX_COMPILER \${CMAKE_CURRENT_LIST_DIR}/bin/${TARGET_TUPLE}-clang++$BIN_EXT)
set(CMAKE_AR \${CMAKE_CURRENT_LIST_DIR}/bin/${TARGET_TUPLE}-ar$BIN_EXT)

set(CMAKE_C_COMPILER_TARGET ${TARGET_TUPLE})
set(CMAKE_CXX_COMPILER_TARGET ${TARGET_TUPLE})

set(CMAKE_FIND_ROOT_PATH "\${CMAKE_CURRENT_LIST_DIR}/")

# Use host tools
set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)

# Only ever build/link to sysroot
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)

EOF
